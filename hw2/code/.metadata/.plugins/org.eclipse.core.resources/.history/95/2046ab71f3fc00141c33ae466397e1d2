package il.ac.technion.cs.sd.app.mail;

import static org.junit.Assert.*;
import il.ac.technion.cs.sd.lib.clientserver.MessageData;
import il.ac.technion.cs.sd.lib.clientserver.Server.ListenLoopAlreadyBeingDone;
import il.ac.technion.cs.sd.lib.clientserver.Server.NoCurrentListenLoop;

import java.awt.TrayIcon.MessageType;
import java.io.BufferedOutputStream;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.io.OutputStream;
import java.io.StringBufferInputStream;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.LinkedList;
import java.util.List;

import org.junit.After;
import org.junit.Before;
import org.junit.Test;

public class ServerMailApplicationTest {

	private List<Mail> _mailList;
	private InputStream inBufferStream = null;
	private InputStream outBufferStream = null;
	ServerMailApplication serverMail;
	
	
	// Use buffers instead of disk.
	private class PersistentConfigWithBuffers implements PersistentConfig {
		@Override
		public InputStream getPersistentMailInputStream() throws IOException {
			return inBufferStream;
		}
		
		@Override
		public OutputStream getPersistentMailOverwriteOutputStream() throws FileNotFoundException {
			return outBufferStream;
		}
	}
	
	
	@Before
	public void setUp() throws Exception {
		List<String> usernames = Arrays.asList("Idan","Ofer","Gal");
		_mailList = new ArrayList<Mail>();
		_mailList.add(new Mail("Idan","Gal","Assignment 2 delay"));
		_mailList.add(new Mail("Gal","Idan","Assignment 2 delayed"));
		_mailList.add(new Mail("Ofer","Idan","We have more time"));
		
		serverMail = new ServerMailApplication("server1");
	} 


	@After
	public void tearDown() throws Exception {
		
	}
	
	@Test (expected=ListenLoopAlreadyBeingDone.class)
	public void starWhenAlreadyStarted() {
		serverMail.start();
		serverMail.start();
	}
	
	
	@Test (expected=ListenLoopAlreadyBeingDone.class)
	public void starWhenAlreadyStarted() {
		serverMail.start();
		serverMail.start();
	}
	
	@Test (expected=NoCurrentListenLoop.class)
	public void stopWhenAlteadyStopped() {
		serverMail.stop();
	}

}
